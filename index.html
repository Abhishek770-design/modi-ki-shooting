<!doctype html>
<html lang="hi">
<head>
<meta name="google-site-verification" content="TjHdG-wbXrYU6LKvA_tI3YwcKyYpMHPy7STYP5hVqCQ" />  
 <meta name="title" content="Modi Ki Shooting - Funny Web Game">
<meta name="description" content="Play Modi Ki Shooting, a fun and entertaining web game created by Abhishek. Shoot targets, score points, and enjoy the action!">
<meta name="keywords" content="Modi game, shooting game, funny game, web game, Abhishek game, Modi Ki Shooting, browser game, HTML game">

<!-- Open Graph (Facebook, WhatsApp, Instagram) -->
<meta property="og:title" content="Modi Ki Shooting - Funny Web Game">
<meta property="og:description" content="A fun shooting game created by Abhishek. Play now!">
<meta property="og:image" content="https://abhishek770-design.github.io/modi-ki-shooting/modiface.jpg">
<meta property="og:url" content="https://abhishek770-design.github.io/modi-ki-shooting/">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Modi Ki Shooting - Funny Web Game">
<meta name="twitter:description" content="Play this fun shooting game made by Abhishek.">
<meta name="twitter:image" content="https://abhishek770-design.github.io/modi-ki-shooting/modiface.jpg">

<!-- Canonical URL -->
<link rel="canonical" href="https://abhishek770-design.github.io/modi-ki-shooting/"> 
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bow & Arrow â€” Shoot Friend (Music Enabled)</title>
<style>
  :root{--bg:#071021;--panel:#0f1b2a;--accent:#ffd36b}
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    display:flex;align-items:center;justify-content:center;
    background:var(--bg);font-family:system-ui,Arial,sans-serif;color:#fff;padding:12px;
  }
  #wrap{width:100%;max-width:980px;border-radius:12px;overflow:hidden;background:linear-gradient(180deg,#0b1a2b,#04101a);box-shadow:0 10px 30px #0008}
  .topbar{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:rgba(255,255,255,0.02)}
  .title{font-weight:700}
  #gameArea{position:relative;background:#071827}
  canvas{display:block;width:100%;height:auto;background:transparent}
  #ui{position:absolute;inset:0;pointer-events:none}
  #hud{position:absolute;left:12px;top:12px;font-size:18px;display:flex;flex-direction:column;gap:6px;pointer-events:none}
  #hudRight{position:absolute;right:12px;top:12px;font-size:18px;display:flex;align-items:center;gap:10px;pointer-events:none}
  #controls{position:absolute;right:12px;top:60px;text-align:right}
  button{cursor:pointer}
  .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.55);pointer-events:auto;flex-direction:column;gap:12px;padding:12px}
  .startRow{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:center}
  .nameCol{display:flex;flex-direction:column;gap:8px;align-items:flex-start}
  input[type="text"]{padding:8px 10px;border-radius:8px;border:1px solid #333;background:#06121a;color:#fff}
  .small{font-size:13px;color:#ddd}
  #leaderboard{max-height:260px;overflow:auto;width:300px;text-align:left;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px}
  #debug{position:absolute;left:12px;bottom:12px;font-size:12px;color:#ccc;background:#0004;padding:6px;border-radius:6px;pointer-events:none}
  .btn { padding:10px 16px;border-radius:8px;border:none;background:linear-gradient(135deg,#4cd964,#34c759);color:#021;font-weight:700;cursor:pointer }
  .btn.secondary { background:linear-gradient(135deg,#4d79ff,#7b61ff); color:#fff }
  .heartWrap{display:flex;align-items:center;gap:6px;background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:999px;pointer-events:auto}
  .heartSvg{width:22px;height:22px;display:inline-block;vertical-align:middle}
  .heartNum{font-weight:700;color:#ffd36b}
  #livesHud{font-weight:700;color:#ffd36b}
  @media (max-width:640px){ .startRow{flex-direction:column} }
</style>
</head>
<body>
  <div id="wrap">
    <div class="topbar">
      <div class="title">Bow & Arrow â€” Shoot Moodi G<sup>**</sup>du</div>
      <div>just for fun ðŸ˜œ</div>
      <div class="small">Hold to charge, release to shoot â€¢ Space / Click / Touch</div>
    </div>

    <div id="gameArea">
      <canvas id="c" width="1000" height="600"></canvas>

      <div id="ui">
        <div id="hud">
          <div id="score">Score: 0</div>
        </div>

        <div id="hudRight">
          <div class="heartWrap" id="heartHUD" title="Lives remaining">
            <svg class="heartSvg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 21s-7.5-4.35-10-7.2C-0.5 9.6 3 4 7.5 6.2 9.2 7.2 10 9 12 10.5 14 9 14.8 7.2 16.5 6.2 21 4 24.5 9.6 22 13.8 19.5 16.85 12 21 12 21z" fill="#ffd36b" opacity="0.95"/>
            </svg>
            <div class="heartNum" id="livesHud">2</div>
          </div>
        </div>

        <div id="controls"><div id="power" class="small">Power: 0%</div></div>

        <div id="startOverlay" class="overlay">
          <div style="text-align:center"><h2>Enter your name</h2></div>

          <div class="startRow">
            <div class="nameCol">
              <input id="playerName" type="text" placeholder="Your name" maxlength="20" />
            </div>

            <div>
              <button id="startBtn" class="btn">Start</button>
            </div>

            <div id="leaderboard">
              <strong>Top 10 Players</strong>
              <div id="lbList"></div>
            </div>
          </div>

         
        </div>

        <div id="countdownOverlay" class="overlay" style="display:none">
          <h1 id="countdownText" style="font-size:72px;margin:0">3</h1>
        </div>

        <div id="gameOverOverlay" class="overlay" style="display:none">
          <h2>Game Over</h2>
          <div id="finalText">Score: 0</div>
          <div style="display:flex;gap:10px">
            <button id="restartBtn" class="btn">Play Again</button>
            <button id="toMenuBtn" class="btn secondary">Main Menu</button>
          </div>
          <div id="gameOverLB" style="margin-top:8px;width:320px"></div>
        </div>

        <div id="debug"></div>
      </div>
    </div>
  </div>
<!-- Basic page info -->
<title>Bow & Arrow â€” Shoot Friend | Play Online</title>
<meta name="description" content="Play Bow & Arrow â€” Shoot Friend online. Hold to charge, release to shoot. Leaderboard, smooth physics, mobile friendly. Play now for free!" />
<meta name="keywords" content="bow and arrow game, online game, shoot friend, browser game, HTML5 game, play online" />
<meta name="author" content="Abhishek" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="canonical" href="https://yourdomain.com/" />

<!-- Open Graph (Facebook, LinkedIn, etc.) -->
<meta property="og:type" content="game" />
<meta property="og:title" content="Bow & Arrow â€” Shoot Friend" />
<meta property="og:description" content="Hold to charge and release to shoot. Play online, compete on the leaderboard. Mobile friendly." />
<meta property="og:url" content="https://yourdomain.com/" />
<meta property="og:image" content="https://yourdomain.com/og-image.png" />
<meta property="og:site_name" content="Bow & Arrow Game" />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Bow & Arrow â€” Shoot Friend" />
<meta name="twitter:description" content="Hold to charge and release to shoot. Play online, compete on the leaderboard." />
<meta name="twitter:image" content="https://yourdomain.com/og-image.png" />

<!-- Optional: favicon -->
<link rel="icon" href="/favicon.ico" />

<!-- JSON-LD structured data (SoftwareApplication) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Bow & Arrow â€” Shoot Friend",
  "url": "https://yourdomain.com/",
  "description": "Hold to charge and release to shoot. Play online and compete on the leaderboard.",
  "applicationCategory": "Game",
  "operatingSystem": "Web",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
}
</script>
<script>
/* ---------- Canvas setup ---------- */
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const LOGICAL_W = 1000, LOGICAL_H = 600;
function fitCanvas(){
  const maxW = Math.min(window.innerWidth - 24, 1000);
  const displayW = maxW;
  const displayH = Math.round(displayW * (LOGICAL_H / LOGICAL_W));
  canvas.style.width = displayW + 'px';
  canvas.style.height = displayH + 'px';
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  canvas.width = LOGICAL_W * dpr;
  canvas.height = LOGICAL_H * dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener('resize', fitCanvas);
fitCanvas();

/* ---------- UI refs ---------- */
const startOverlay = document.getElementById('startOverlay');
const countdownOverlay = document.getElementById('countdownOverlay');
const countdownText = document.getElementById('countdownText');
const gameOverOverlay = document.getElementById('gameOverOverlay');
const playerNameInput = document.getElementById('playerName');
const startBtn = document.getElementById('startBtn');
const restartBtn = document.getElementById('restartBtn');
const toMenuBtn = document.getElementById('toMenuBtn');
const lbList = document.getElementById('lbList');
const gameOverLB = document.getElementById('gameOverLB');
const scoreEl = document.getElementById('score');
const powerEl = document.getElementById('power');
const debugEl = document.getElementById('debug');
const finalText = document.getElementById('finalText');
const livesHud = document.getElementById('livesHud');

/* ---------- Leaderboard ---------- */
const LB_KEY = 'bow_friend_leaderboard_v2';
function loadLeaderboard(){ try{ return JSON.parse(localStorage.getItem(LB_KEY) || '[]'); }catch(e){ return []; } }
function saveLeaderboard(list){ localStorage.setItem(LB_KEY, JSON.stringify(list)); }
function addScore(name, score){
  const list = loadLeaderboard();
  list.push({name: name||'Anon', score: Math.max(0, Math.floor(score)), time: Date.now()});
  list.sort((a,b)=> b.score - a.score || a.time - b.time);
  saveLeaderboard(list.slice(0,10));
}
function renderLeaderboard(targetEl){
  const list = loadLeaderboard();
  if (!list.length){ targetEl.innerHTML = '<div class="small">No scores yet</div>'; return; }
  targetEl.innerHTML = list.map((p,i)=>`<div>${i+1}. <strong>${escapeHtml(p.name)}</strong> â€” ${p.score}</div>`).join('');
}
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }
renderLeaderboard(lbList);

/* ---------- Game state ---------- */
let running = false;
let score = 0;
let playerName = '';
let lastTime = performance.now();

/* target */
const target = { x: LOGICAL_W - 180, y: LOGICAL_H/2, r: 70 };

/* bow/arrow */
let isCharging = false;
let chargeStart = 0;
let charge = 0;
const MAX_CHARGE = 1.0;
const MIN_CHARGE = 0.06;
const arrows = [];
const particles = [];

/* misses: allow 2 misses per player */
let misses = 0;
const ALLOWED_MISSES = 2;

/* optional friend image */
const friendImg = new Image();
let friendLoaded = false;
friendImg.onload = ()=> friendLoaded = true;
friendImg.onerror = ()=> friendLoaded = false;
friendImg.src = 'modiface.jpg'; // optional

/* ---------- Background music (HTMLAudio with fade) ---------- */
// Place bg.mp3 in same folder as this index.html
const bgAudio = new Audio('modis.mp3');
bgAudio.loop = true;
bgAudio.preload = 'auto';
const BG_TARGET_VOL = 0.35;
bgAudio.volume = 0;

bgAudio.addEventListener('canplay', ()=> console.log('bg.mp3 canplay'));
bgAudio.addEventListener('play', ()=> console.log('bg.mp3 play event'));
bgAudio.addEventListener('error', (e)=> console.error('bg.mp3 error', e));

function fadeInAudio(audio, duration = 700) {
  try {
    audio.volume = 0;
    const step = 50;
    const inc = (BG_TARGET_VOL / (duration / step));
    audio.play().catch(err => console.warn('play blocked until user gesture', err));
    const t = setInterval(() => {
      audio.volume = Math.min(BG_TARGET_VOL, audio.volume + inc);
      if (audio.volume >= BG_TARGET_VOL) clearInterval(t);
    }, step);
  } catch(e){ console.error('fadeInAudio error', e); }
}

function fadeOutAudio(audio, duration = 400) {
  try {
    const step = 50;
    const dec = (audio.volume / (duration / step));
    const t = setInterval(() => {
      audio.volume = Math.max(0, audio.volume - dec);
      if (audio.volume <= 0) {
        audio.pause();
        audio.currentTime = 0;
        clearInterval(t);
      }
    }, step);
  } catch(e){ console.error('fadeOutAudio error', e); }
}

function startBackgroundMusicHTML(){
  fadeInAudio(bgAudio, 700);
}
function stopBackgroundMusicHTML(){
  fadeOutAudio(bgAudio, 400);
}

/* ---------- Input ---------- */
let pointerDown = false;
function startCharge(){
  if (!running) return;
  if (!pointerDown){
    pointerDown = true;
    isCharging = true;
    chargeStart = performance.now();
  }
}
function endCharge(){
  if (!running) return;
  if (!pointerDown) return;
  pointerDown = false;
  if (!isCharging) return;
  isCharging = false;
  const dt = (performance.now() - chargeStart)/1000;
  charge = Math.min(MAX_CHARGE, dt/1.2 + MIN_CHARGE);
  shootArrow(charge);
  charge = 0;
}
canvas.addEventListener('mousedown', ()=> startCharge());
canvas.addEventListener('mouseup', ()=> endCharge());
canvas.addEventListener('mouseleave', ()=> endCharge());
canvas.addEventListener('touchstart', e=>{ e.preventDefault(); startCharge(); }, {passive:false});
canvas.addEventListener('touchend', e=>{ e.preventDefault(); endCharge(); }, {passive:false});
document.addEventListener('keydown', e=>{
  if (e.code === 'Space'){ e.preventDefault(); if (!running) return; if (!pointerDown) startCharge(); else endCharge(); }
});

/* ---------- Shooting with smooth ramp ---------- */
function shootArrow(power){
  const startX = 140, startY = LOGICAL_H/2;
  const dx = target.x - startX, dy = target.y - startY;
  const baseAngle = Math.atan2(dy, dx);
  const spread = (1 - power) * 0.18;
  const angle = baseAngle + (Math.random()*2-1)*spread;
  const speed = 520 * (0.6 + 0.8*power);
  const vx0 = Math.cos(angle) * speed;
  const vy0 = Math.sin(angle) * speed;
  arrows.push({ x: startX, y: startY, vx0, vy0, vx: vx0*0.05, vy: vy0*0.05, angle, alive:true, time:0, ramp:0.12 });
  playShootSound(power);
}

/* ---------- Audio effects (synth) ---------- */
let audioCtx = null;
function ensureAudioCtx(){ if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
function playShootSound(power){
  try{
    ensureAudioCtx();
    const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
    o.type = 'sawtooth'; o.frequency.value = 400 + power*700; g.gain.value = 0.001 + power*0.02;
    o.connect(g); g.connect(audioCtx.destination); o.start();
    o.frequency.exponentialRampToValueAtTime(120, audioCtx.currentTime + 0.28);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.32);
    o.stop(audioCtx.currentTime + 0.34);
  }catch(e){}
}
function playHitSound(){
  try{
    ensureAudioCtx();
    const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
    o.type = 'square'; o.frequency.value = 260; g.gain.value = 0.08;
    o.connect(g); g.connect(audioCtx.destination); o.start();
    o.frequency.exponentialRampToValueAtTime(120, audioCtx.currentTime + 0.18);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.28);
    o.stop(audioCtx.currentTime + 0.32);
  }catch(e){}
}

/* ---------- Collision, particles, drawing ---------- */
function checkArrowHit(a){
  const dx = a.x - target.x, dy = a.y - target.y;
  return dx*dx + dy*dy <= (target.r * target.r);
}
function spawnHitParticles(x,y){
  for (let i=0;i<18;i++){
    const ang = Math.random()*Math.PI*2;
    const sp = 80 + Math.random()*220;
    particles.push({ x,y, vx:Math.cos(ang)*sp, vy:Math.sin(ang)*sp, life:0.6 + Math.random()*0.6 });
  }
}
function drawBow(ctx){
  const bx = 120, by = LOGICAL_H/2;
  ctx.save(); ctx.translate(bx, by);
  ctx.beginPath(); ctx.strokeStyle = '#8b5a2b'; ctx.lineWidth = 12;
  ctx.arc(0,0,70, -Math.PI/2.6, Math.PI/2.6, false); ctx.stroke();
  ctx.beginPath(); ctx.strokeStyle = '#ddd'; ctx.lineWidth = 3;
  const pull = isCharging ? Math.min(80, (performance.now()-chargeStart)/6) : 0;
  ctx.moveTo(0, -70); ctx.quadraticCurveTo(-pull, 0, 0, 70); ctx.stroke();
  if (isCharging){
    ctx.save();
    const arrowX = -pull/1.6;
    ctx.translate(arrowX, 0);
    ctx.fillStyle = '#c9b79a'; ctx.fillRect(-12, -4, 44, 8);
    ctx.beginPath(); ctx.fillStyle = '#444'; ctx.moveTo(34,0); ctx.lineTo(46,8); ctx.lineTo(46,-8); ctx.closePath(); ctx.fill();
    ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.moveTo(-12,0); ctx.lineTo(-22,8); ctx.lineTo(-16,0); ctx.lineTo(-22,-8); ctx.closePath(); ctx.fill();
    ctx.restore();
  }
  ctx.restore();
}
function drawArrow(ctx,a){
  ctx.save(); ctx.translate(a.x, a.y); ctx.rotate(a.angle);
  ctx.fillStyle = '#c9b79a'; ctx.fillRect(-12, -3, 44, 6);
  ctx.beginPath(); ctx.fillStyle = '#444'; ctx.moveTo(34,0); ctx.lineTo(46,7); ctx.lineTo(46,-7); ctx.closePath(); ctx.fill();
  ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.moveTo(-12,0); ctx.lineTo(-22,7); ctx.lineTo(-16,0); ctx.lineTo(-22,-7); ctx.closePath(); ctx.fill();
  ctx.restore();
}
function drawCactus(x,y,w,h,fromTop){
  ctx.save();
  if (fromTop){ ctx.translate(x,y); ctx.scale(1,-1); y=0; }
  ctx.fillStyle='#2ecc71'; ctx.strokeStyle='#145a32'; ctx.lineWidth=3;
  ctx.beginPath();
  const rx = x + w*0.25, rw = w*0.5;
  ctx.moveTo(rx+10,y); ctx.lineTo(rx+rw-10,y); ctx.quadraticCurveTo(rx+rw,y,rx+rw,y+10);
  ctx.lineTo(rx+rw,y+h-10); ctx.quadraticCurveTo(rx+rw,y+h,rx+rw-10,y+h);
  ctx.lineTo(rx+10,y+h); ctx.quadraticCurveTo(rx,y+h,rx,y+h-10);
  ctx.lineTo(rx,y+10); ctx.quadraticCurveTo(rx,y,rx+10,y); ctx.closePath();
  ctx.fill(); ctx.stroke();
  ctx.beginPath(); ctx.rect(x, y + h*0.28, w*0.25, h*0.36); ctx.fill(); ctx.stroke();
  ctx.beginPath(); ctx.rect(x + w*0.75, y + h*0.22, w*0.25, h*0.36); ctx.fill(); ctx.stroke();
  ctx.restore();
}

/* ---------- Main loop ---------- */
let prev = performance.now();
function mainLoop(now){
  const dt = Math.min(0.05, (now - prev)/1000);
  prev = now;
  if (running) updateFrame(dt);
  render();
  requestAnimationFrame(mainLoop);
}
requestAnimationFrame(mainLoop);

function updateFrame(dt){
  if (isCharging){
    const t = (performance.now() - chargeStart)/1000;
    charge = Math.min(MAX_CHARGE, t/1.2 + MIN_CHARGE);
    powerEl.textContent = 'Power: ' + Math.round(charge*100) + '%';
  } else {
    powerEl.textContent = 'Power: 0%';
  }

  for (let i = arrows.length-1; i>=0; i--){
    const a = arrows[i];
    a.time = (a.time || 0) + dt;
    const rampT = a.ramp || 0.12;
    const f = Math.min(1, a.time / rampT);
    const ease = f*f*(3 - 2*f);
    a.vx = a.vx0 * ease;
    a.vy = a.vy0 * ease + (a.vy || 0);
    a.x += a.vx * dt;
    a.y += a.vy * dt;
    a.vy += 600 * dt * 0.02;
    a.angle = Math.atan2(a.vy, a.vx);

    if (a.x < -50 || a.x > LOGICAL_W + 50 || a.y < -50 || a.y > LOGICAL_H + 50){
      arrows.splice(i,1);
      misses++;
      updateLivesUI();
      if (misses >= ALLOWED_MISSES){ finishGame(); return; }
      continue;
    }

    if (checkArrowHit(a)){
      arrows.splice(i,1);
      misses = 0;
      updateLivesUI();
      const gained = Math.max(1, Math.round(10 * (0.5 + charge)));
      score += gained;
      scoreEl.textContent = 'Score: ' + score;
      playHitSound();
      spawnHitParticles(target.x, target.y);
    }
  }

  for (let i = particles.length-1; i>=0; i--){
    const p = particles[i];
    p.x += p.vx * dt; p.y += p.vy * dt;
    p.vx *= 0.98; p.vy *= 0.98; p.life -= dt;
    if (p.life <= 0) particles.splice(i,1);
  }
}

/* ---------- Render ---------- */
function render(){
  ctx.clearRect(0,0,LOGICAL_W,LOGICAL_H);
  const g = ctx.createLinearGradient(0,0,0,LOGICAL_H);
  g.addColorStop(0,'#0b2a3a'); g.addColorStop(1,'#021018');
  ctx.fillStyle = g; ctx.fillRect(0,0,LOGICAL_W,LOGICAL_H);

  drawBow(ctx);

  ctx.save(); ctx.beginPath(); ctx.arc(target.x, target.y, target.r, 0, Math.PI*2); ctx.closePath(); ctx.fillStyle = '#222'; ctx.fill();
  if (friendLoaded){
    ctx.save(); ctx.beginPath(); ctx.arc(target.x, target.y, target.r, 0, Math.PI*2); ctx.clip();
    ctx.drawImage(friendImg, target.x - target.r, target.y - target.r, target.r*2, target.r*2);
    ctx.restore();
  } else {
    ctx.fillStyle = '#ffd166'; ctx.beginPath(); ctx.arc(target.x, target.y, target.r-6, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(target.x-18, target.y-10, 6, 0, Math.PI*2); ctx.arc(target.x+18, target.y-10, 6, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(target.x, target.y+8, 22, 0, Math.PI); ctx.strokeStyle='#000'; ctx.lineWidth=4; ctx.stroke();
  }
  ctx.restore();

  drawCactus(420, LOGICAL_H - 160, 80, 140, false);
  drawCactus(520, 0, 80, 140, true);

  for (const a of arrows) drawArrow(ctx, a);
  for (const p of particles){ ctx.fillStyle = `rgba(255,200,80,${Math.max(0,p.life)})`; ctx.fillRect(p.x-2,p.y-2,4,4); }
}

/* ---------- Game flow ---------- */
function startCountdownAndRun(){
  countdownOverlay.style.display = 'flex';
  let n = 3; countdownText.textContent = n;
  const iv = setInterval(()=>{
    n--;
    if (n > 0) countdownText.textContent = n;
    else {
      clearInterval(iv);
      countdownOverlay.style.display = 'none';
      running = true;
      score = 0; scoreEl.textContent = 'Score: 0';
      misses = 0; updateLivesUI();
      arrows.length = 0; particles.length = 0;
      try{ if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume(); }catch(e){}
      startBackgroundMusicHTML();
    }
  }, 700);
}

/* Start button click and Enter key both start game */
startBtn.addEventListener('click', ()=>{
  playerName = (playerNameInput.value || 'Anon').trim().slice(0,20);
  if (!playerName) playerName = 'Anon';
  startOverlay.style.display = 'none';
  startCountdownAndRun();
});
playerNameInput.addEventListener('keydown', e=>{
  if (e.key === 'Enter'){
    playerName = (playerNameInput.value || 'Anon').trim().slice(0,20);
    if (!playerName) playerName = 'Anon';
    startOverlay.style.display = 'none';
    startCountdownAndRun();
  }
});

/* Restart and menu */
restartBtn.addEventListener('click', ()=>{ gameOverOverlay.style.display = 'none'; startCountdownAndRun(); });
toMenuBtn.addEventListener('click', ()=>{ gameOverOverlay.style.display = 'none'; startOverlay.style.display = 'flex'; renderLeaderboard(lbList); });

/* finish game */
function finishGame(){
  running = false;
  stopBackgroundMusicHTML();
  addScore(playerName || 'Anon', score);
  renderLeaderboard(gameOverLB);
  finalText.textContent = 'Score: ' + score;
  gameOverOverlay.style.display = 'flex';
}

/* update lives UI */
function updateLivesUI(){
  const remaining = Math.max(0, ALLOWED_MISSES - misses);
  livesHud.textContent = remaining;
}

/* initial UI */
updateLivesUI();
renderLeaderboard(lbList);
</script>
</body>
</html>